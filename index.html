<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>VVVVVV Save Editor</title>
<link rel="icon" href="icon.png" type="image/png" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root {
    color-scheme: dark;
  }
  body {
    font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    margin: 20px;
    background-color: #121212;
    color: #e0e0e0;
  }
  h1 { margin-bottom: 12px; }
  label { display: block; margin-top: 10px; font-weight: 600; }
  input, select {
    width: 100%;
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #444;
    background-color: #1e1e1e;
    color: #e0e0e0;
  }
  button {
    margin-top: 16px;
    padding: 10px 16px;
    border-radius: 8px;
    border: 1px solid #444;
    cursor: pointer;
    background-color: #2a2a2a;
    color: #e0e0e0;
  }
  button:hover {
    background-color: #333;
  }
  .card {
    border: 1px solid #333;
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 20px;
    background-color: #1a1a1a;
  }
  #topbar {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }
  /* Popup styling */
  #tutorialPopup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #1e1e1e;
    border: 1px solid #444;
    border-radius: 12px;
    padding: 20px;
    max-width: 400px;
    z-index: 1000;
    color: #e0e0e0;
  }
  #tutorialPopup p {
    margin: 10px 0;
  }
  #tutorialPopup p.small {
    font-size: 0.8rem;
  }
  #overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    z-index: 999;
  }
</style>
</head>
<body>
<div id="topbar">
  <button onclick="location.href='old.html'">Old Editor</button>
  <button onclick="showTutorial()">How to find save file</button>
</div>

<h1>VVVVVV Save Editor</h1>
<p>Upload your .vvv save file, edit the fields, then download the updated save.</p>

<div class="card">
  <label for="fileInput">Upload Save File (.vvv)</label>
  <input id="fileInput" type="file" accept=".vvv,.xml,text/xml" />
</div>

<div class="card">
  <label for="room">Room</label>
  <select id="room">
    <option>The Ship</option>
    <option>Welcome Aboard</option>
    <option>The Lab</option>
    <option>The Tower</option>
    <option>The Warp Zone</option>
    <option>The Space Station</option>
    <option>The Final Level</option>
    <option>The Edge</option>
    <option>The Gravitron</option>
    <option>The Secret Lab</option>
  </select>

  <label for="companion">Companion</label>
  <select id="companion">
    <option value="0">None</option>
    <option value="1">Crewmate</option>
    <option value="2">Super Crewmate</option>
  </select>

  <label for="trinkets">Number of Trinkets</label>
  <input id="trinkets" type="number" min="0" max="20" />

  <label for="hours">Hours</label>
  <input id="hours" type="number" min="0" />
  <label for="minutes">Minutes</label>
  <input id="minutes" type="number" min="0" max="59" />
  <label for="seconds">Seconds</label>
  <input id="seconds" type="number" min="0" max="59" />
  <label for="deaths">Deaths</label>
  <input id="deaths" type="number" min="0" />
  <label for="flips">Flips</label>
  <input id="flips" type="number" min="0" />

  <label for="bgm">Background Music</label>
  <select id="bgm">
    <option value="0">Passion for Exploring</option>
    <option value="1">Potential for Anything</option>
    <option value="2">Positive Force</option>
    <option value="3">Presenting VVVVVV</option>
    <option value="4">Predestined Fate</option>
    <option value="5">Pressure Cooker</option>
  </select>

  <button id="saveBtn">Download Updated Save</button>
</div>

<!-- Tutorial popup -->
<div id="overlay"></div>
<div id="tutorialPopup">
  <p class="small">This is for the Steam version of VVVVVV on Windows.</p>
  <p>1. Go to your Documents folder</p>
  <p>2. Open the "VVVVVV" folder</p>
  <p>3. Find "qsave.vvv". That's your save file.</p>
  <p>4. Upload it to this page to edit it.</p>
  <button onclick="hideTutorial()">OK</button>
</div>

<script>
let dom = null;

function parseXmlString(xmlStr) {
  const parser = new DOMParser();
  const doc = parser.parseFromString(xmlStr, "application/xml");
  if (doc.getElementsByTagName("parsererror").length) {
    throw new Error("XML parse error");
  }
  return doc;
}

function getTag(doc, name) {
  const el = doc.querySelector(name);
  return el ? el.textContent : "";
}

function setTag(doc, name, value) {
  let el = doc.querySelector(name);
  if (!el) {
    const parent = doc.querySelector("Data") || doc.documentElement;
    el = doc.createElement(name);
    parent.appendChild(el);
  }
  el.textContent = value;
}

function loadIntoForm(doc) {
  dom = doc;
  document.getElementById("room").value = getTag(doc, "summary") || "The Ship";
  document.getElementById("companion").value = getTag(doc, "companion") || "0";
  document.getElementById("trinkets").value = getTag(doc, "trinkets") || "0";
  document.getElementById("hours").value = getTag(doc, "hours") || "0";
  document.getElementById("minutes").value = getTag(doc, "minutes") || "0";
  document.getElementById("seconds").value = getTag(doc, "seconds") || "0";
  document.getElementById("deaths").value = getTag(doc, "deathcounts") || "0";
  document.getElementById("flips").value = getTag(doc, "totalflips") || "0";
  document.getElementById("bgm").value = getTag(doc, "currentsong") || "0";
}

function syncFormToDom() {
  setTag(dom, "summary", document.getElementById("room").value);
  setTag(dom, "companion", document.getElementById("companion").value);
  setTag(dom, "trinkets", document.getElementById("trinkets").value);
  setTag(dom, "hours", document.getElementById("hours").value);
  setTag(dom, "minutes", document.getElementById("minutes").value);
  setTag(dom, "seconds", document.getElementById("seconds").value);
  setTag(dom, "deathcounts", document.getElementById("deaths").value);
  setTag(dom, "totalflips", document.getElementById("flips").value);
  setTag(dom, "currentsong", document.getElementById("bgm").value);
}

function downloadFile(filename, text) {
  const blob = new Blob([text], { type: "text/xml" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);
}

document.getElementById("fileInput").addEventListener("change", (e) => {
  const file = e.target.files?.[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = () => {
    try {
      const text = String(reader.result);
      const doc = parseXmlString(text);
      loadIntoForm(doc);
    } catch (err) {
      alert("Failed to parse .vvv file as XML.");
    }
  };
  reader.readAsText(file);
});

document.getElementById("saveBtn").addEventListener("click", () => {
  if (!dom) {
    alert("No save file loaded.");
    return;
  }
  syncFormToDom();
  const serializer = new XMLSerializer();
  const xmlStr = serializer.serializeToString(dom);
  downloadFile("save.vvv", xmlStr);
});

// Tutorial popup functions
function showTutorial() {
  document.getElementById("tutorialPopup").style.display = "block";
  document.getElementById("overlay").style.display = "block";
}

function hideTutorial() {
  document.getElementById("tutorialPopup").style.display = "none";
  document.getElementById("overlay").style.display = "none";
}
</script>
    <footer style="margin-top:40px; font-size:12px; color:#666; text-align:center;">
  This project is almost entirely AI-generated. I am not associated with the developer of VVVVVV.
</footer>  
</body>
</html>
